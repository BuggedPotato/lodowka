(()=>{"use strict";var t=function(){function t(){}return t.showEditForm=function(e){var n=document.getElementById("wysiwyg");n.style.display="flex",n.dataset.editingNote=e.toString(),t.addButtonsToStatus()},t.hideEditForm=function(e){e.preventDefault(),document.getElementById("wysiwyg").style.display="none",t.removeButtonsFromStatus()},t.addButtonsToStatus=function(){var e=document.getElementsByClassName("tox-statusbar__text-container")[0],n=document.createElement("button");n.classList.add("btnTinyMCE"),n.id="TinyMCECancel",e.appendChild(n);var o=document.createElement("button");o.classList.add("btnTinyMCE"),o.id="TinyMCESave",o.type="submit",e.appendChild(o),n.addEventListener("click",t.hideEditForm)},t.removeButtonsFromStatus=function(){var t=document.getElementsByClassName("tox-statusbar__text-container")[0],e=document.getElementById("TinyMCECancel"),n=document.getElementById("TinyMCESave");t.removeChild(e),t.removeChild(n)},t}(),e=function(){function e(t,e,n,o,i,r){void 0===n&&(n={x:160,y:160}),void 0===o&&(o={x:100,y:100}),void 0===i&&(i="Hello there!"),void 0===r&&(r=100),this.id=t,this.parentFunctions=e,this.size=n,this.position=o,this.text=i,this.zIndex=r}return e.prototype.getNoteHTML=function(){var t=document.createElement("div");t.classList.add("note"),t.id=this.id.toString(),t.style.width=this.size.x.toString()+"px",t.style.height=this.size.y.toString()+"px",t.style.top=this.position.y.toString()+"px",t.style.left=this.position.x.toString()+"px",t.style.zIndex=this.zIndex.toString();var e=document.createElement("div");e.classList.add("textbox"),e.innerHTML="<p>"+this.text+"</p>",t.appendChild(e);var n=document.createElement("img");n.classList.add("icon"),n.classList.add("delNote"),n.src="./gfx/crossIcon.png",t.appendChild(n);var o=document.createElement("img");o.classList.add("icon"),o.classList.add("resizeNote"),o.src="./gfx/resizeIcon.jpeg",t.appendChild(o);var i=document.createElement("img");return i.classList.add("icon"),i.classList.add("editNote"),i.src="./gfx/editIcon.png",t.appendChild(i),this.setEvents(t,n,o,i),t},e.prototype.setEvents=function(e,n,o,i){var r=this;e.addEventListener("mousedown",(function(t){r.zIndex=r.parentFunctions.getTopIndex(),e.style.zIndex=r.zIndex.toString(),r.doTheDragThingy(t,e,r)})),n.addEventListener("click",(function(t){n.parentNode.parentNode.removeChild(e),r.parentFunctions.deleteNote(r.id),r.parentFunctions.saveMe()})),o.addEventListener("mousedown",(function(t){r.resizeMe(t,o,e,r)})),i.addEventListener("click",(function(e){setEditorContent(r),t.showEditForm(r.id)}))},e.prototype.doTheDragThingy=function(t,e,n){e.style.backgroundColor="#ffebcc";var o=t.clientX,i=t.clientY,r=e.offsetLeft,s=e.offsetTop,a=o-r,c=i-s;function d(t){var o=t.clientX-a,i=t.clientY-c;e.style.left=o.toString()+"px",e.style.top=i.toString()+"px",n.position={x:o,y:i},t.stopPropagation()}document.addEventListener("mousemove",d,!0),document.addEventListener("mouseup",(function t(o){document.removeEventListener("mousemove",d,!0),document.removeEventListener("mouseup",t,!0),e.style.backgroundColor="papayawhip",o.stopPropagation(),n.parentFunctions.saveMe()}),!0),t.stopPropagation(),t.preventDefault()},e.prototype.resizeMe=function(t,e,n,o){var i=t.clientX,r=t.clientY,s=e.offsetLeft,a=e.offsetTop,c=i-s,d=r-a;function u(t){var e=t.clientX-c+20,i=t.clientY-d+20;e=e<=100?parseInt(n.style.width.replace("px","")):e,i=i<=100?parseInt(n.style.height.replace("px","")):i,n.style.width=e.toString()+"px",n.style.height=i.toString()+"px",o.size={x:e,y:i},t.stopPropagation()}document.addEventListener("mousemove",u,!0),document.addEventListener("mouseup",(function t(e){document.removeEventListener("mousemove",u,!0),document.removeEventListener("mouseup",t,!0),e.stopPropagation(),o.parentFunctions.saveMe()}),!0),t.stopPropagation(),t.preventDefault()},e.prototype.getSize=function(){return this.size},e}(),n=function(){function t(){}return t.getFridgeData=function(t){var e="data="+JSON.stringify({mode:"getFridge",name:t});return fetch("./php/dbhandle.php",{method:"post",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.json()})).then((function(t){return t[0]}))},t.saveFridge=function(t){return e=this,n=void 0,i=function(){var e,n;return function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(o){return e={"Content-Type":"application/x-www-form-urlencoded"},n="data="+JSON.stringify({mode:"saveFridge",fridge:JSON.stringify(t)}),[2,fetch("./php/dbhandle.php",{method:"post",body:n,headers:e}).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.json()}))]}))},new((o=void 0)||(o=Promise))((function(t,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(s,a)}c((i=i.apply(e,n||[])).next())}));var e,n,o,i},t}(),o=function(){function t(t,e,o,i){var r=this;void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0),this.stickyNotes=[],this.functions4Notes={getTopIndex:function(){return r.topIndex++,r.topIndex},deleteNote:function(t){r.stickyNotes=r.stickyNotes.filter((function(e){return e.id!=t||(r.currentNotes--,r.updateFridge(),!1)}))},saveMe:function(){console.log("Saved!"),n.saveFridge(r)}},this.name=t,this.totalNotes=e,this.currentNotes=o,this.topIndex=i}return t.prototype.addStickyNote=function(){var t=new e(this.topIndex+1,this.functions4Notes);this.stickyNotes.push(t),this.currentNotes=this.stickyNotes.length,this.topIndex++,this.totalNotes++,this.updateFridge()},t.prototype.renderNotes=function(t){this.stickyNotes.map((function(e){document.getElementById(e.id.toString())||document.getElementById(t).appendChild(e.getNoteHTML())}))},t.prototype.getNoteOfId=function(t){return this.stickyNotes.find((function(e){return e.id==t}))},t.prototype.updateFridge=function(){document.getElementById("totalNotes").innerText="Przebieg: "+this.totalNotes.toString(),document.getElementById("currentNotes").innerText="Karteczki: "+this.currentNotes.toString()},t.prototype.setTop=function(t){this.topIndex=t},t}(),i=new URLSearchParams(window.location.search).get("fridgeName");i||window.location.replace("./start.html");var r=new o(i);!function(t,o){var i,r,s,a;i=this,r=void 0,a=function(){var i,r,s;return function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(a){switch(a.label){case 0:return[4,n.getFridgeData(o)];case 1:return(i=a.sent())?(r=JSON.parse(i.Data),console.log(r),s=JSON.parse(i.StickyNotesTab),t.totalNotes=r.totalNotes,t.currentNotes=r.currentNotes,t.setTop(r.topIndex),t.stickyNotes=s.map((function(n){return new e(n.id,t.functions4Notes,n.size,n.position,n.text,n.zIndex)})),t.renderNotes("fridge"),t.updateFridge(),[2]):(t.functions4Notes.saveMe(),[2])}}))},new((s=void 0)||(s=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function o(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(n,o)}c((a=a.apply(i,r||[])).next())}))}(r,i),document.getElementById("newNote").addEventListener("click",(function(){r.addStickyNote(),r.renderNotes("fridge")})),document.body.onload=function(){setListener(r)}})();